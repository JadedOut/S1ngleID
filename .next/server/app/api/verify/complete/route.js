"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/verify/complete/route";
exports.ids = ["app/api/verify/complete/route"];
exports.modules = {

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("@prisma/client");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fverify%2Fcomplete%2Froute&page=%2Fapi%2Fverify%2Fcomplete%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fverify%2Fcomplete%2Froute.ts&appDir=C%3A%5CUsers%5Cjiami%5COneDrive%5CDesktop%5Cworkspace%5Ckms_please%5Csduarf%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cjiami%5COneDrive%5CDesktop%5Cworkspace%5Ckms_please%5Csduarf&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fverify%2Fcomplete%2Froute&page=%2Fapi%2Fverify%2Fcomplete%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fverify%2Fcomplete%2Froute.ts&appDir=C%3A%5CUsers%5Cjiami%5COneDrive%5CDesktop%5Cworkspace%5Ckms_please%5Csduarf%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cjiami%5COneDrive%5CDesktop%5Cworkspace%5Ckms_please%5Csduarf&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_jiami_OneDrive_Desktop_workspace_kms_please_sduarf_src_app_api_verify_complete_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/verify/complete/route.ts */ \"(rsc)/./src/app/api/verify/complete/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/verify/complete/route\",\n        pathname: \"/api/verify/complete\",\n        filename: \"route\",\n        bundlePath: \"app/api/verify/complete/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\jiami\\\\OneDrive\\\\Desktop\\\\workspace\\\\kms_please\\\\sduarf\\\\src\\\\app\\\\api\\\\verify\\\\complete\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_jiami_OneDrive_Desktop_workspace_kms_please_sduarf_src_app_api_verify_complete_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/verify/complete/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZ2ZXJpZnklMkZjb21wbGV0ZSUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGdmVyaWZ5JTJGY29tcGxldGUlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZ2ZXJpZnklMkZjb21wbGV0ZSUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNqaWFtaSU1Q09uZURyaXZlJTVDRGVza3RvcCU1Q3dvcmtzcGFjZSU1Q2ttc19wbGVhc2UlNUNzZHVhcmYlNUNzcmMlNUNhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPUMlM0ElNUNVc2VycyU1Q2ppYW1pJTVDT25lRHJpdmUlNUNEZXNrdG9wJTVDd29ya3NwYWNlJTVDa21zX3BsZWFzZSU1Q3NkdWFyZiZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDNkQ7QUFDMUk7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxpRUFBaUU7QUFDekU7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUN1SDs7QUFFdkgiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zZHVhcmYvPzNkYTMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiQzpcXFxcVXNlcnNcXFxcamlhbWlcXFxcT25lRHJpdmVcXFxcRGVza3RvcFxcXFx3b3Jrc3BhY2VcXFxca21zX3BsZWFzZVxcXFxzZHVhcmZcXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxcdmVyaWZ5XFxcXGNvbXBsZXRlXFxcXHJvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS92ZXJpZnkvY29tcGxldGUvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS92ZXJpZnkvY29tcGxldGVcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL3ZlcmlmeS9jb21wbGV0ZS9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIkM6XFxcXFVzZXJzXFxcXGppYW1pXFxcXE9uZURyaXZlXFxcXERlc2t0b3BcXFxcd29ya3NwYWNlXFxcXGttc19wbGVhc2VcXFxcc2R1YXJmXFxcXHNyY1xcXFxhcHBcXFxcYXBpXFxcXHZlcmlmeVxcXFxjb21wbGV0ZVxcXFxyb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvdmVyaWZ5L2NvbXBsZXRlL3JvdXRlXCI7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHNlcnZlckhvb2tzLFxuICAgICAgICBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIG9yaWdpbmFsUGF0aG5hbWUsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fverify%2Fcomplete%2Froute&page=%2Fapi%2Fverify%2Fcomplete%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fverify%2Fcomplete%2Froute.ts&appDir=C%3A%5CUsers%5Cjiami%5COneDrive%5CDesktop%5Cworkspace%5Ckms_please%5Csduarf%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cjiami%5COneDrive%5CDesktop%5Cworkspace%5Ckms_please%5Csduarf&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/verify/complete/route.ts":
/*!**********************************************!*\
  !*** ./src/app/api/verify/complete/route.ts ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   OPTIONS: () => (/* binding */ OPTIONS),\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   runtime: () => (/* binding */ runtime)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _simplewebauthn_server__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @simplewebauthn/server */ \"(rsc)/./node_modules/@simplewebauthn/server/esm/index.js\");\n/* harmony import */ var _lib_server_prisma__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/server/prisma */ \"(rsc)/./src/lib/server/prisma.ts\");\n/* harmony import */ var _lib_server_cors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/server/cors */ \"(rsc)/./src/lib/server/cors.ts\");\n\n\n\n\n// Force Node.js runtime\nconst runtime = \"nodejs\";\n// WebAuthn configuration from environment\nconst WEBAUTHN_RP_ID = process.env.WEBAUTHN_RP_ID || \"localhost\";\nconst WEBAUTHN_ORIGIN = process.env.WEBAUTHN_ORIGIN || \"http://localhost:3000\";\n/**\r\n * Handle OPTIONS preflight for CORS\r\n */ async function OPTIONS(request) {\n    return (0,_lib_server_cors__WEBPACK_IMPORTED_MODULE_3__.handleCorsOptions)(request);\n}\n/**\r\n * POST /api/verify/complete\r\n * \r\n * Input: { userId: string, attestationResponse: RegistrationResponseJSON }\r\n * \r\n * Flow:\r\n * 1. Load expected challenge from database\r\n * 2. Verify attestation with @simplewebauthn/server\r\n * 3. Store credential in database\r\n * \r\n * Output: { success: true, credential_id: string }\r\n */ async function POST(request) {\n    try {\n        const body = await request.json();\n        const { userId, attestationResponse } = body;\n        // Validate input\n        if (!userId || typeof userId !== \"string\") {\n            const response = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Missing or invalid userId\"\n            }, {\n                status: 400\n            });\n            return (0,_lib_server_cors__WEBPACK_IMPORTED_MODULE_3__.withCors)(response, request);\n        }\n        if (!attestationResponse || typeof attestationResponse !== \"object\") {\n            const response = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Missing or invalid attestationResponse\"\n            }, {\n                status: 400\n            });\n            return (0,_lib_server_cors__WEBPACK_IMPORTED_MODULE_3__.withCors)(response, request);\n        }\n        console.log(\"[verify/complete] Verifying attestation for user:\", userId);\n        // #region agent log\n        const fs = __webpack_require__(/*! fs */ \"fs\");\n        const logPath = \"c:\\\\Users\\\\jiami\\\\OneDrive\\\\Desktop\\\\workspace\\\\kms_please\\\\sduarf\\\\.cursor\\\\debug.log\";\n        try {\n            fs.appendFileSync(logPath, JSON.stringify({\n                location: \"verify/complete/route.ts:58\",\n                message: \"Starting verification\",\n                data: {\n                    userId,\n                    hasAttestationResponse: !!attestationResponse,\n                    attestationId: attestationResponse?.id\n                },\n                timestamp: Date.now(),\n                sessionId: \"debug-session\",\n                runId: \"run7\",\n                hypothesisId: \"D\"\n            }) + \"\\n\");\n        } catch  {}\n        // #endregion\n        // === Step 1: Load expected challenge from database ===\n        const challengeRecord = await _lib_server_prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.webAuthnChallenge.findFirst({\n            where: {\n                userId,\n                type: \"registration\",\n                expiresAt: {\n                    gt: new Date()\n                }\n            },\n            orderBy: {\n                createdAt: \"desc\"\n            }\n        });\n        // #region agent log\n        try {\n            fs.appendFileSync(logPath, JSON.stringify({\n                location: \"verify/complete/route.ts:69\",\n                message: \"Challenge lookup result\",\n                data: {\n                    found: !!challengeRecord,\n                    userId,\n                    challengeFromDb: challengeRecord?.challenge,\n                    challengeFromResponse: attestationResponse?.response?.clientDataJSON ? JSON.parse(Buffer.from(attestationResponse.response.clientDataJSON, \"base64url\").toString()).challenge : null\n                },\n                timestamp: Date.now(),\n                sessionId: \"debug-session\",\n                runId: \"run7\",\n                hypothesisId: \"D\"\n            }) + \"\\n\");\n        } catch  {}\n        // #endregion\n        if (!challengeRecord) {\n            console.error(\"[verify/complete] No valid challenge found for user:\", userId);\n            const response = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"No valid challenge found. Please restart verification.\"\n            }, {\n                status: 400\n            });\n            return (0,_lib_server_cors__WEBPACK_IMPORTED_MODULE_3__.withCors)(response, request);\n        }\n        console.log(\"[verify/complete] Found challenge, verifying attestation...\");\n        console.log(\"[verify/complete] Expected RP_ID:\", WEBAUTHN_RP_ID);\n        console.log(\"[verify/complete] Expected ORIGIN:\", WEBAUTHN_ORIGIN);\n        // === Step 2: Verify attestation ===\n        let verification;\n        try {\n            // #region agent log\n            try {\n                fs.appendFileSync(logPath, JSON.stringify({\n                    location: \"verify/complete/route.ts:86\",\n                    message: \"Calling verifyRegistrationResponse\",\n                    data: {\n                        expectedChallenge: challengeRecord.challenge,\n                        expectedOrigin: WEBAUTHN_ORIGIN,\n                        expectedRPID: WEBAUTHN_RP_ID\n                    },\n                    timestamp: Date.now(),\n                    sessionId: \"debug-session\",\n                    runId: \"run7\",\n                    hypothesisId: \"E\"\n                }) + \"\\n\");\n            } catch  {}\n            // #endregion\n            verification = await (0,_simplewebauthn_server__WEBPACK_IMPORTED_MODULE_1__.verifyRegistrationResponse)({\n                response: attestationResponse,\n                expectedChallenge: challengeRecord.challenge,\n                expectedOrigin: WEBAUTHN_ORIGIN,\n                expectedRPID: WEBAUTHN_RP_ID,\n                requireUserVerification: false\n            });\n            // #region agent log\n            try {\n                fs.appendFileSync(logPath, JSON.stringify({\n                    location: \"verify/complete/route.ts:93\",\n                    message: \"Verification succeeded\",\n                    data: {\n                        verified: verification.verified,\n                        hasRegistrationInfo: !!verification.registrationInfo\n                    },\n                    timestamp: Date.now(),\n                    sessionId: \"debug-session\",\n                    runId: \"run7\",\n                    hypothesisId: \"E\"\n                }) + \"\\n\");\n            } catch  {}\n        // #endregion\n        } catch (verifyError) {\n            // #region agent log\n            try {\n                fs.appendFileSync(logPath, JSON.stringify({\n                    location: \"verify/complete/route.ts:96\",\n                    message: \"Verification error\",\n                    data: {\n                        errorName: verifyError?.name,\n                        errorMessage: verifyError?.message,\n                        errorStack: verifyError?.stack?.substring(0, 300)\n                    },\n                    timestamp: Date.now(),\n                    sessionId: \"debug-session\",\n                    runId: \"run7\",\n                    hypothesisId: \"E\"\n                }) + \"\\n\");\n            } catch  {}\n            // #endregion\n            console.error(\"[verify/complete] Verification error:\", verifyError);\n            const response = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Credential verification failed\",\n                details: verifyError instanceof Error ? verifyError.message : \"Unknown error\"\n            }, {\n                status: 400\n            });\n            return (0,_lib_server_cors__WEBPACK_IMPORTED_MODULE_3__.withCors)(response, request);\n        }\n        if (!verification.verified || !verification.registrationInfo) {\n            // #region agent log\n            try {\n                fs.appendFileSync(logPath, JSON.stringify({\n                    location: \"verify/complete/route.ts:105\",\n                    message: \"Verification failed (not verified)\",\n                    data: {\n                        verified: verification.verified,\n                        hasRegistrationInfo: !!verification.registrationInfo\n                    },\n                    timestamp: Date.now(),\n                    sessionId: \"debug-session\",\n                    runId: \"run7\",\n                    hypothesisId: \"E\"\n                }) + \"\\n\");\n            } catch  {}\n            // #endregion\n            console.error(\"[verify/complete] Verification failed\");\n            const response = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Credential verification failed\"\n            }, {\n                status: 400\n            });\n            return (0,_lib_server_cors__WEBPACK_IMPORTED_MODULE_3__.withCors)(response, request);\n        }\n        console.log(\"[verify/complete] Attestation verified!\");\n        const { registrationInfo } = verification;\n        // === Step 3: Store credential in database ===\n        // Convert credential ID to base64url for storage\n        const credentialIdBase64 = Buffer.from(registrationInfo.credentialID).toString(\"base64url\");\n        // Check for duplicate credential\n        const existingCredential = await _lib_server_prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.webAuthnCredential.findUnique({\n            where: {\n                credentialId: credentialIdBase64\n            }\n        });\n        if (existingCredential) {\n            console.error(\"[verify/complete] Duplicate credential detected\");\n            const response = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"This credential is already registered\"\n            }, {\n                status: 400\n            });\n            return (0,_lib_server_cors__WEBPACK_IMPORTED_MODULE_3__.withCors)(response, request);\n        }\n        // Store the credential\n        // Note: transports are not directly available in registrationInfo\n        // They would need to be extracted from the attestation response if needed\n        // For now, we'll store an empty array (transports are optional)\n        const credential = await _lib_server_prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.webAuthnCredential.create({\n            data: {\n                userId,\n                credentialId: credentialIdBase64,\n                publicKey: Buffer.from(registrationInfo.credentialPublicKey),\n                counter: registrationInfo.counter,\n                transports: []\n            }\n        });\n        console.log(\"[verify/complete] Credential stored:\", credential.id);\n        // Delete the used challenge (one-time use)\n        await _lib_server_prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.webAuthnChallenge.delete({\n            where: {\n                id: challengeRecord.id\n            }\n        });\n        // Return success with the stable credential ID\n        const response = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            credential_id: credential.id,\n            credentialIdBase64\n        });\n        return (0,_lib_server_cors__WEBPACK_IMPORTED_MODULE_3__.withCors)(response, request);\n    } catch (error) {\n        console.error(\"[verify/complete] Error:\", error);\n        const response = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: error instanceof Error ? error.message : \"Registration failed\"\n        }, {\n            status: 500\n        });\n        return (0,_lib_server_cors__WEBPACK_IMPORTED_MODULE_3__.withCors)(response, request);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS92ZXJpZnkvY29tcGxldGUvcm91dGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUF3RDtBQUNZO0FBRXZCO0FBQ21CO0FBRWhFLHdCQUF3QjtBQUNqQixNQUFNSyxVQUFVLFNBQVM7QUFFaEMsMENBQTBDO0FBQzFDLE1BQU1DLGlCQUFpQkMsUUFBUUMsR0FBRyxDQUFDRixjQUFjLElBQUk7QUFDckQsTUFBTUcsa0JBQWtCRixRQUFRQyxHQUFHLENBQUNDLGVBQWUsSUFBSTtBQUV2RDs7Q0FFQyxHQUNNLGVBQWVDLFFBQVFDLE9BQW9CO0lBQ2hELE9BQU9SLG1FQUFpQkEsQ0FBQ1E7QUFDM0I7QUFFQTs7Ozs7Ozs7Ozs7Q0FXQyxHQUNNLGVBQWVDLEtBQUtELE9BQW9CO0lBQzdDLElBQUk7UUFDRixNQUFNRSxPQUFPLE1BQU1GLFFBQVFHLElBQUk7UUFDL0IsTUFBTSxFQUFFQyxNQUFNLEVBQUVDLG1CQUFtQixFQUFFLEdBQUdIO1FBS3hDLGlCQUFpQjtRQUNqQixJQUFJLENBQUNFLFVBQVUsT0FBT0EsV0FBVyxVQUFVO1lBQ3pDLE1BQU1FLFdBQVdqQixxREFBWUEsQ0FBQ2MsSUFBSSxDQUNoQztnQkFBRUksT0FBTztZQUE0QixHQUNyQztnQkFBRUMsUUFBUTtZQUFJO1lBRWhCLE9BQU9mLDBEQUFRQSxDQUFDYSxVQUFVTjtRQUM1QjtRQUVBLElBQUksQ0FBQ0ssdUJBQXVCLE9BQU9BLHdCQUF3QixVQUFVO1lBQ25FLE1BQU1DLFdBQVdqQixxREFBWUEsQ0FBQ2MsSUFBSSxDQUNoQztnQkFBRUksT0FBTztZQUF5QyxHQUNsRDtnQkFBRUMsUUFBUTtZQUFJO1lBRWhCLE9BQU9mLDBEQUFRQSxDQUFDYSxVQUFVTjtRQUM1QjtRQUVBUyxRQUFRQyxHQUFHLENBQUMscURBQXFETjtRQUVqRSxvQkFBb0I7UUFDcEIsTUFBTU8sS0FBS0MsbUJBQU9BLENBQUM7UUFDbkIsTUFBTUMsVUFBVTtRQUNoQixJQUFJO1lBQ0ZGLEdBQUdH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QUFDO1lBQ3BDNUMsT0FBTztnQkFBRVYsSUFBSU8sZ0JBQWdCUCxFQUFFO1lBQUM7UUFDbEM7UUFFQSwrQ0FBK0M7UUFDL0MsTUFBTWhCLFdBQVdqQixxREFBWUEsQ0FBQ2MsSUFBSSxDQUFDO1lBQ2pDMEUsU0FBUztZQUNUQyxlQUFlUixXQUFXaEQsRUFBRTtZQUM1QjBDO1FBQ0Y7UUFDQSxPQUFPdkUsMERBQVFBLENBQUNhLFVBQVVOO0lBQzVCLEVBQUUsT0FBT08sT0FBTztRQUNkRSxRQUFRRixLQUFLLENBQUMsNEJBQTRCQTtRQUMxQyxNQUFNRCxXQUFXakIscURBQVlBLENBQUNjLElBQUksQ0FDaEM7WUFBRUksT0FBT0EsaUJBQWlCd0QsUUFBUXhELE1BQU1XLE9BQU8sR0FBRztRQUFzQixHQUN4RTtZQUFFVixRQUFRO1FBQUk7UUFFaEIsT0FBT2YsMERBQVFBLENBQUNhLFVBQVVOO0lBQzVCO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zZHVhcmYvLi9zcmMvYXBwL2FwaS92ZXJpZnkvY29tcGxldGUvcm91dGUudHM/ZjZiMCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSBcIm5leHQvc2VydmVyXCI7XHJcbmltcG9ydCB7IHZlcmlmeVJlZ2lzdHJhdGlvblJlc3BvbnNlIH0gZnJvbSBcIkBzaW1wbGV3ZWJhdXRobi9zZXJ2ZXJcIjtcclxuaW1wb3J0IHR5cGUgeyBSZWdpc3RyYXRpb25SZXNwb25zZUpTT04gfSBmcm9tIFwiQHNpbXBsZXdlYmF1dGhuL3R5cGVzXCI7XHJcbmltcG9ydCB7IHByaXNtYSB9IGZyb20gXCJAL2xpYi9zZXJ2ZXIvcHJpc21hXCI7XHJcbmltcG9ydCB7IGhhbmRsZUNvcnNPcHRpb25zLCB3aXRoQ29ycyB9IGZyb20gXCJAL2xpYi9zZXJ2ZXIvY29yc1wiO1xyXG5cclxuLy8gRm9yY2UgTm9kZS5qcyBydW50aW1lXHJcbmV4cG9ydCBjb25zdCBydW50aW1lID0gXCJub2RlanNcIjtcclxuXHJcbi8vIFdlYkF1dGhuIGNvbmZpZ3VyYXRpb24gZnJvbSBlbnZpcm9ubWVudFxyXG5jb25zdCBXRUJBVVRITl9SUF9JRCA9IHByb2Nlc3MuZW52LldFQkFVVEhOX1JQX0lEIHx8IFwibG9jYWxob3N0XCI7XHJcbmNvbnN0IFdFQkFVVEhOX09SSUdJTiA9IHByb2Nlc3MuZW52LldFQkFVVEhOX09SSUdJTiB8fCBcImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMFwiO1xyXG5cclxuLyoqXHJcbiAqIEhhbmRsZSBPUFRJT05TIHByZWZsaWdodCBmb3IgQ09SU1xyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIE9QVElPTlMocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcclxuICByZXR1cm4gaGFuZGxlQ29yc09wdGlvbnMocmVxdWVzdCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBQT1NUIC9hcGkvdmVyaWZ5L2NvbXBsZXRlXHJcbiAqIFxyXG4gKiBJbnB1dDogeyB1c2VySWQ6IHN0cmluZywgYXR0ZXN0YXRpb25SZXNwb25zZTogUmVnaXN0cmF0aW9uUmVzcG9uc2VKU09OIH1cclxuICogXHJcbiAqIEZsb3c6XHJcbiAqIDEuIExvYWQgZXhwZWN0ZWQgY2hhbGxlbmdlIGZyb20gZGF0YWJhc2VcclxuICogMi4gVmVyaWZ5IGF0dGVzdGF0aW9uIHdpdGggQHNpbXBsZXdlYmF1dGhuL3NlcnZlclxyXG4gKiAzLiBTdG9yZSBjcmVkZW50aWFsIGluIGRhdGFiYXNlXHJcbiAqIFxyXG4gKiBPdXRwdXQ6IHsgc3VjY2VzczogdHJ1ZSwgY3JlZGVudGlhbF9pZDogc3RyaW5nIH1cclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZXF1ZXN0Lmpzb24oKTtcclxuICAgIGNvbnN0IHsgdXNlcklkLCBhdHRlc3RhdGlvblJlc3BvbnNlIH0gPSBib2R5IGFzIHtcclxuICAgICAgdXNlcklkOiBzdHJpbmc7XHJcbiAgICAgIGF0dGVzdGF0aW9uUmVzcG9uc2U6IFJlZ2lzdHJhdGlvblJlc3BvbnNlSlNPTjtcclxuICAgIH07XHJcblxyXG4gICAgLy8gVmFsaWRhdGUgaW5wdXRcclxuICAgIGlmICghdXNlcklkIHx8IHR5cGVvZiB1c2VySWQgIT09IFwic3RyaW5nXCIpIHtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IGVycm9yOiBcIk1pc3Npbmcgb3IgaW52YWxpZCB1c2VySWRcIiB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxyXG4gICAgICApO1xyXG4gICAgICByZXR1cm4gd2l0aENvcnMocmVzcG9uc2UsIHJlcXVlc3QpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghYXR0ZXN0YXRpb25SZXNwb25zZSB8fCB0eXBlb2YgYXR0ZXN0YXRpb25SZXNwb25zZSAhPT0gXCJvYmplY3RcIikge1xyXG4gICAgICBjb25zdCByZXNwb25zZSA9IE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgIHsgZXJyb3I6IFwiTWlzc2luZyBvciBpbnZhbGlkIGF0dGVzdGF0aW9uUmVzcG9uc2VcIiB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxyXG4gICAgICApO1xyXG4gICAgICByZXR1cm4gd2l0aENvcnMocmVzcG9uc2UsIHJlcXVlc3QpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnNvbGUubG9nKFwiW3ZlcmlmeS9jb21wbGV0ZV0gVmVyaWZ5aW5nIGF0dGVzdGF0aW9uIGZvciB1c2VyOlwiLCB1c2VySWQpO1xyXG5cclxuICAgIC8vICNyZWdpb24gYWdlbnQgbG9nXHJcbiAgICBjb25zdCBmcyA9IHJlcXVpcmUoJ2ZzJyk7XHJcbiAgICBjb25zdCBsb2dQYXRoID0gJ2M6XFxcXFVzZXJzXFxcXGppYW1pXFxcXE9uZURyaXZlXFxcXERlc2t0b3BcXFxcd29ya3NwYWNlXFxcXGttc19wbGVhc2VcXFxcc2R1YXJmXFxcXC5jdXJzb3JcXFxcZGVidWcubG9nJztcclxuICAgIHRyeSB7XHJcbiAgICAgIGZzLmFwcGVuZEZpbGVTeW5jKGxvZ1BhdGgsIEpTT04uc3RyaW5naWZ5KHtsb2NhdGlvbjondmVyaWZ5L2NvbXBsZXRlL3JvdXRlLnRzOjU4JyxtZXNzYWdlOidTdGFydGluZyB2ZXJpZmljYXRpb24nLGRhdGE6e3VzZXJJZCxoYXNBdHRlc3RhdGlvblJlc3BvbnNlOiEhYXR0ZXN0YXRpb25SZXNwb25zZSxhdHRlc3RhdGlvbklkOmF0dGVzdGF0aW9uUmVzcG9uc2U/LmlkfSx0aW1lc3RhbXA6RGF0ZS5ub3coKSxzZXNzaW9uSWQ6J2RlYnVnLXNlc3Npb24nLHJ1bklkOidydW43JyxoeXBvdGhlc2lzSWQ6J0QnfSkrJ1xcbicpO1xyXG4gICAgfSBjYXRjaCB7fVxyXG4gICAgLy8gI2VuZHJlZ2lvblxyXG5cclxuICAgIC8vID09PSBTdGVwIDE6IExvYWQgZXhwZWN0ZWQgY2hhbGxlbmdlIGZyb20gZGF0YWJhc2UgPT09XHJcbiAgICBjb25zdCBjaGFsbGVuZ2VSZWNvcmQgPSBhd2FpdCBwcmlzbWEud2ViQXV0aG5DaGFsbGVuZ2UuZmluZEZpcnN0KHtcclxuICAgICAgd2hlcmU6IHtcclxuICAgICAgICB1c2VySWQsXHJcbiAgICAgICAgdHlwZTogXCJyZWdpc3RyYXRpb25cIixcclxuICAgICAgICBleHBpcmVzQXQ6IHsgZ3Q6IG5ldyBEYXRlKCkgfSwgLy8gTm90IGV4cGlyZWRcclxuICAgICAgfSxcclxuICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6IFwiZGVzY1wiIH0sIC8vIE1vc3QgcmVjZW50IGZpcnN0XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyAjcmVnaW9uIGFnZW50IGxvZ1xyXG4gICAgdHJ5IHtcclxuICAgICAgZnMuYXBwZW5kRmlsZVN5bmMobG9nUGF0aCwgSlNPTi5zdHJpbmdpZnkoe2xvY2F0aW9uOid2ZXJpZnkvY29tcGxldGUvcm91dGUudHM6NjknLG1lc3NhZ2U6J0NoYWxsZW5nZSBsb29rdXAgcmVzdWx0JyxkYXRhOntmb3VuZDohIWNoYWxsZW5nZVJlY29yZCx1c2VySWQsY2hhbGxlbmdlRnJvbURiOmNoYWxsZW5nZVJlY29yZD8uY2hhbGxlbmdlLGNoYWxsZW5nZUZyb21SZXNwb25zZTphdHRlc3RhdGlvblJlc3BvbnNlPy5yZXNwb25zZT8uY2xpZW50RGF0YUpTT04gPyBKU09OLnBhcnNlKEJ1ZmZlci5mcm9tKGF0dGVzdGF0aW9uUmVzcG9uc2UucmVzcG9uc2UuY2xpZW50RGF0YUpTT04sICdiYXNlNjR1cmwnKS50b1N0cmluZygpKS5jaGFsbGVuZ2UgOiBudWxsfSx0aW1lc3RhbXA6RGF0ZS5ub3coKSxzZXNzaW9uSWQ6J2RlYnVnLXNlc3Npb24nLHJ1bklkOidydW43JyxoeXBvdGhlc2lzSWQ6J0QnfSkrJ1xcbicpO1xyXG4gICAgfSBjYXRjaCB7fVxyXG4gICAgLy8gI2VuZHJlZ2lvblxyXG5cclxuICAgIGlmICghY2hhbGxlbmdlUmVjb3JkKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJbdmVyaWZ5L2NvbXBsZXRlXSBObyB2YWxpZCBjaGFsbGVuZ2UgZm91bmQgZm9yIHVzZXI6XCIsIHVzZXJJZCk7XHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgeyBlcnJvcjogXCJObyB2YWxpZCBjaGFsbGVuZ2UgZm91bmQuIFBsZWFzZSByZXN0YXJ0IHZlcmlmaWNhdGlvbi5cIiB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxyXG4gICAgICApO1xyXG4gICAgICByZXR1cm4gd2l0aENvcnMocmVzcG9uc2UsIHJlcXVlc3QpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnNvbGUubG9nKFwiW3ZlcmlmeS9jb21wbGV0ZV0gRm91bmQgY2hhbGxlbmdlLCB2ZXJpZnlpbmcgYXR0ZXN0YXRpb24uLi5cIik7XHJcbiAgICBjb25zb2xlLmxvZyhcIlt2ZXJpZnkvY29tcGxldGVdIEV4cGVjdGVkIFJQX0lEOlwiLCBXRUJBVVRITl9SUF9JRCk7XHJcbiAgICBjb25zb2xlLmxvZyhcIlt2ZXJpZnkvY29tcGxldGVdIEV4cGVjdGVkIE9SSUdJTjpcIiwgV0VCQVVUSE5fT1JJR0lOKTtcclxuXHJcbiAgICAvLyA9PT0gU3RlcCAyOiBWZXJpZnkgYXR0ZXN0YXRpb24gPT09XHJcbiAgICBsZXQgdmVyaWZpY2F0aW9uO1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gI3JlZ2lvbiBhZ2VudCBsb2dcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBmcy5hcHBlbmRGaWxlU3luYyhsb2dQYXRoLCBKU09OLnN0cmluZ2lmeSh7bG9jYXRpb246J3ZlcmlmeS9jb21wbGV0ZS9yb3V0ZS50czo4NicsbWVzc2FnZTonQ2FsbGluZyB2ZXJpZnlSZWdpc3RyYXRpb25SZXNwb25zZScsZGF0YTp7ZXhwZWN0ZWRDaGFsbGVuZ2U6Y2hhbGxlbmdlUmVjb3JkLmNoYWxsZW5nZSxleHBlY3RlZE9yaWdpbjpXRUJBVVRITl9PUklHSU4sZXhwZWN0ZWRSUElEOldFQkFVVEhOX1JQX0lEfSx0aW1lc3RhbXA6RGF0ZS5ub3coKSxzZXNzaW9uSWQ6J2RlYnVnLXNlc3Npb24nLHJ1bklkOidydW43JyxoeXBvdGhlc2lzSWQ6J0UnfSkrJ1xcbicpO1xyXG4gICAgICB9IGNhdGNoIHt9XHJcbiAgICAgIC8vICNlbmRyZWdpb25cclxuICAgICAgXHJcbiAgICAgIHZlcmlmaWNhdGlvbiA9IGF3YWl0IHZlcmlmeVJlZ2lzdHJhdGlvblJlc3BvbnNlKHtcclxuICAgICAgICByZXNwb25zZTogYXR0ZXN0YXRpb25SZXNwb25zZSxcclxuICAgICAgICBleHBlY3RlZENoYWxsZW5nZTogY2hhbGxlbmdlUmVjb3JkLmNoYWxsZW5nZSxcclxuICAgICAgICBleHBlY3RlZE9yaWdpbjogV0VCQVVUSE5fT1JJR0lOLFxyXG4gICAgICAgIGV4cGVjdGVkUlBJRDogV0VCQVVUSE5fUlBfSUQsXHJcbiAgICAgICAgcmVxdWlyZVVzZXJWZXJpZmljYXRpb246IGZhbHNlLCAvLyBBbGxvdyBVVi1jYXBhYmxlIGJ1dCBub3QgcmVxdWlyZWRcclxuICAgICAgfSk7XHJcbiAgICAgIFxyXG4gICAgICAvLyAjcmVnaW9uIGFnZW50IGxvZ1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGZzLmFwcGVuZEZpbGVTeW5jKGxvZ1BhdGgsIEpTT04uc3RyaW5naWZ5KHtsb2NhdGlvbjondmVyaWZ5L2NvbXBsZXRlL3JvdXRlLnRzOjkzJyxtZXNzYWdlOidWZXJpZmljYXRpb24gc3VjY2VlZGVkJyxkYXRhOnt2ZXJpZmllZDp2ZXJpZmljYXRpb24udmVyaWZpZWQsaGFzUmVnaXN0cmF0aW9uSW5mbzohIXZlcmlmaWNhdGlvbi5yZWdpc3RyYXRpb25JbmZvfSx0aW1lc3RhbXA6RGF0ZS5ub3coKSxzZXNzaW9uSWQ6J2RlYnVnLXNlc3Npb24nLHJ1bklkOidydW43JyxoeXBvdGhlc2lzSWQ6J0UnfSkrJ1xcbicpO1xyXG4gICAgICB9IGNhdGNoIHt9XHJcbiAgICAgIC8vICNlbmRyZWdpb25cclxuICAgIH0gY2F0Y2ggKHZlcmlmeUVycm9yKSB7XHJcbiAgICAgIC8vICNyZWdpb24gYWdlbnQgbG9nXHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgZnMuYXBwZW5kRmlsZVN5bmMobG9nUGF0aCwgSlNPTi5zdHJpbmdpZnkoe2xvY2F0aW9uOid2ZXJpZnkvY29tcGxldGUvcm91dGUudHM6OTYnLG1lc3NhZ2U6J1ZlcmlmaWNhdGlvbiBlcnJvcicsZGF0YTp7ZXJyb3JOYW1lOih2ZXJpZnlFcnJvciBhcyBFcnJvcik/Lm5hbWUsZXJyb3JNZXNzYWdlOih2ZXJpZnlFcnJvciBhcyBFcnJvcik/Lm1lc3NhZ2UsZXJyb3JTdGFjazoodmVyaWZ5RXJyb3IgYXMgRXJyb3IpPy5zdGFjaz8uc3Vic3RyaW5nKDAsMzAwKX0sdGltZXN0YW1wOkRhdGUubm93KCksc2Vzc2lvbklkOidkZWJ1Zy1zZXNzaW9uJyxydW5JZDoncnVuNycsaHlwb3RoZXNpc0lkOidFJ30pKydcXG4nKTtcclxuICAgICAgfSBjYXRjaCB7fVxyXG4gICAgICAvLyAjZW5kcmVnaW9uXHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJbdmVyaWZ5L2NvbXBsZXRlXSBWZXJpZmljYXRpb24gZXJyb3I6XCIsIHZlcmlmeUVycm9yKTtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IFxyXG4gICAgICAgICAgZXJyb3I6IFwiQ3JlZGVudGlhbCB2ZXJpZmljYXRpb24gZmFpbGVkXCIsXHJcbiAgICAgICAgICBkZXRhaWxzOiB2ZXJpZnlFcnJvciBpbnN0YW5jZW9mIEVycm9yID8gdmVyaWZ5RXJyb3IubWVzc2FnZSA6IFwiVW5rbm93biBlcnJvclwiXHJcbiAgICAgICAgfSxcclxuICAgICAgICB7IHN0YXR1czogNDAwIH1cclxuICAgICAgKTtcclxuICAgICAgcmV0dXJuIHdpdGhDb3JzKHJlc3BvbnNlLCByZXF1ZXN0KTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIXZlcmlmaWNhdGlvbi52ZXJpZmllZCB8fCAhdmVyaWZpY2F0aW9uLnJlZ2lzdHJhdGlvbkluZm8pIHtcclxuICAgICAgLy8gI3JlZ2lvbiBhZ2VudCBsb2dcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBmcy5hcHBlbmRGaWxlU3luYyhsb2dQYXRoLCBKU09OLnN0cmluZ2lmeSh7bG9jYXRpb246J3ZlcmlmeS9jb21wbGV0ZS9yb3V0ZS50czoxMDUnLG1lc3NhZ2U6J1ZlcmlmaWNhdGlvbiBmYWlsZWQgKG5vdCB2ZXJpZmllZCknLGRhdGE6e3ZlcmlmaWVkOnZlcmlmaWNhdGlvbi52ZXJpZmllZCxoYXNSZWdpc3RyYXRpb25JbmZvOiEhdmVyaWZpY2F0aW9uLnJlZ2lzdHJhdGlvbkluZm99LHRpbWVzdGFtcDpEYXRlLm5vdygpLHNlc3Npb25JZDonZGVidWctc2Vzc2lvbicscnVuSWQ6J3J1bjcnLGh5cG90aGVzaXNJZDonRSd9KSsnXFxuJyk7XHJcbiAgICAgIH0gY2F0Y2gge31cclxuICAgICAgLy8gI2VuZHJlZ2lvblxyXG4gICAgICBjb25zb2xlLmVycm9yKFwiW3ZlcmlmeS9jb21wbGV0ZV0gVmVyaWZpY2F0aW9uIGZhaWxlZFwiKTtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IGVycm9yOiBcIkNyZWRlbnRpYWwgdmVyaWZpY2F0aW9uIGZhaWxlZFwiIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XHJcbiAgICAgICk7XHJcbiAgICAgIHJldHVybiB3aXRoQ29ycyhyZXNwb25zZSwgcmVxdWVzdCk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc29sZS5sb2coXCJbdmVyaWZ5L2NvbXBsZXRlXSBBdHRlc3RhdGlvbiB2ZXJpZmllZCFcIik7XHJcblxyXG4gICAgY29uc3QgeyByZWdpc3RyYXRpb25JbmZvIH0gPSB2ZXJpZmljYXRpb247XHJcblxyXG4gICAgLy8gPT09IFN0ZXAgMzogU3RvcmUgY3JlZGVudGlhbCBpbiBkYXRhYmFzZSA9PT1cclxuICAgIC8vIENvbnZlcnQgY3JlZGVudGlhbCBJRCB0byBiYXNlNjR1cmwgZm9yIHN0b3JhZ2VcclxuICAgIGNvbnN0IGNyZWRlbnRpYWxJZEJhc2U2NCA9IEJ1ZmZlci5mcm9tKHJlZ2lzdHJhdGlvbkluZm8uY3JlZGVudGlhbElEKS50b1N0cmluZyhcImJhc2U2NHVybFwiKTtcclxuXHJcbiAgICAvLyBDaGVjayBmb3IgZHVwbGljYXRlIGNyZWRlbnRpYWxcclxuICAgIGNvbnN0IGV4aXN0aW5nQ3JlZGVudGlhbCA9IGF3YWl0IHByaXNtYS53ZWJBdXRobkNyZWRlbnRpYWwuZmluZFVuaXF1ZSh7XHJcbiAgICAgIHdoZXJlOiB7IGNyZWRlbnRpYWxJZDogY3JlZGVudGlhbElkQmFzZTY0IH0sXHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAoZXhpc3RpbmdDcmVkZW50aWFsKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJbdmVyaWZ5L2NvbXBsZXRlXSBEdXBsaWNhdGUgY3JlZGVudGlhbCBkZXRlY3RlZFwiKTtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IGVycm9yOiBcIlRoaXMgY3JlZGVudGlhbCBpcyBhbHJlYWR5IHJlZ2lzdGVyZWRcIiB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxyXG4gICAgICApO1xyXG4gICAgICByZXR1cm4gd2l0aENvcnMocmVzcG9uc2UsIHJlcXVlc3QpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFN0b3JlIHRoZSBjcmVkZW50aWFsXHJcbiAgICAvLyBOb3RlOiB0cmFuc3BvcnRzIGFyZSBub3QgZGlyZWN0bHkgYXZhaWxhYmxlIGluIHJlZ2lzdHJhdGlvbkluZm9cclxuICAgIC8vIFRoZXkgd291bGQgbmVlZCB0byBiZSBleHRyYWN0ZWQgZnJvbSB0aGUgYXR0ZXN0YXRpb24gcmVzcG9uc2UgaWYgbmVlZGVkXHJcbiAgICAvLyBGb3Igbm93LCB3ZSdsbCBzdG9yZSBhbiBlbXB0eSBhcnJheSAodHJhbnNwb3J0cyBhcmUgb3B0aW9uYWwpXHJcbiAgICBjb25zdCBjcmVkZW50aWFsID0gYXdhaXQgcHJpc21hLndlYkF1dGhuQ3JlZGVudGlhbC5jcmVhdGUoe1xyXG4gICAgICBkYXRhOiB7XHJcbiAgICAgICAgdXNlcklkLFxyXG4gICAgICAgIGNyZWRlbnRpYWxJZDogY3JlZGVudGlhbElkQmFzZTY0LFxyXG4gICAgICAgIHB1YmxpY0tleTogQnVmZmVyLmZyb20ocmVnaXN0cmF0aW9uSW5mby5jcmVkZW50aWFsUHVibGljS2V5KSxcclxuICAgICAgICBjb3VudGVyOiByZWdpc3RyYXRpb25JbmZvLmNvdW50ZXIsXHJcbiAgICAgICAgdHJhbnNwb3J0czogW10sIC8vIFRyYW5zcG9ydHMgbm90IGF2YWlsYWJsZSBpbiByZWdpc3RyYXRpb25JbmZvLCB3b3VsZCBuZWVkIHRvIHBhcnNlIGZyb20gcmVzcG9uc2VcclxuICAgICAgfSxcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnNvbGUubG9nKFwiW3ZlcmlmeS9jb21wbGV0ZV0gQ3JlZGVudGlhbCBzdG9yZWQ6XCIsIGNyZWRlbnRpYWwuaWQpO1xyXG5cclxuICAgIC8vIERlbGV0ZSB0aGUgdXNlZCBjaGFsbGVuZ2UgKG9uZS10aW1lIHVzZSlcclxuICAgIGF3YWl0IHByaXNtYS53ZWJBdXRobkNoYWxsZW5nZS5kZWxldGUoe1xyXG4gICAgICB3aGVyZTogeyBpZDogY2hhbGxlbmdlUmVjb3JkLmlkIH0sXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBSZXR1cm4gc3VjY2VzcyB3aXRoIHRoZSBzdGFibGUgY3JlZGVudGlhbCBJRFxyXG4gICAgY29uc3QgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UuanNvbih7XHJcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgIGNyZWRlbnRpYWxfaWQ6IGNyZWRlbnRpYWwuaWQsXHJcbiAgICAgIGNyZWRlbnRpYWxJZEJhc2U2NCwgLy8gQWxzbyByZXR1cm4gdGhlIHJhdyBjcmVkZW50aWFsIElEIGZvciByZWZlcmVuY2VcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHdpdGhDb3JzKHJlc3BvbnNlLCByZXF1ZXN0KTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcihcIlt2ZXJpZnkvY29tcGxldGVdIEVycm9yOlwiLCBlcnJvcik7XHJcbiAgICBjb25zdCByZXNwb25zZSA9IE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICB7IGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFwiUmVnaXN0cmF0aW9uIGZhaWxlZFwiIH0sXHJcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxyXG4gICAgKTtcclxuICAgIHJldHVybiB3aXRoQ29ycyhyZXNwb25zZSwgcmVxdWVzdCk7XHJcbiAgfVxyXG59XHJcbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJ2ZXJpZnlSZWdpc3RyYXRpb25SZXNwb25zZSIsInByaXNtYSIsImhhbmRsZUNvcnNPcHRpb25zIiwid2l0aENvcnMiLCJydW50aW1lIiwiV0VCQVVUSE5fUlBfSUQiLCJwcm9jZXNzIiwiZW52IiwiV0VCQVVUSE5fT1JJR0lOIiwiT1BUSU9OUyIsInJlcXVlc3QiLCJQT1NUIiwiYm9keSIsImpzb24iLCJ1c2VySWQiLCJhdHRlc3RhdGlvblJlc3BvbnNlIiwicmVzcG9uc2UiLCJlcnJvciIsInN0YXR1cyIsImNvbnNvbGUiLCJsb2ciLCJmcyIsInJlcXVpcmUiLCJsb2dQYXRoIiwiYXBwZW5kRmlsZVN5bmMiLCJKU09OIiwic3RyaW5naWZ5IiwibG9jYXRpb24iLCJtZXNzYWdlIiwiZGF0YSIsImhhc0F0dGVzdGF0aW9uUmVzcG9uc2UiLCJhdHRlc3RhdGlvbklkIiwiaWQiLCJ0aW1lc3RhbXAiLCJEYXRlIiwibm93Iiwic2Vzc2lvbklkIiwicnVuSWQiLCJoeXBvdGhlc2lzSWQiLCJjaGFsbGVuZ2VSZWNvcmQiLCJ3ZWJBdXRobkNoYWxsZW5nZSIsImZpbmRGaXJzdCIsIndoZXJlIiwidHlwZSIsImV4cGlyZXNBdCIsImd0Iiwib3JkZXJCeSIsImNyZWF0ZWRBdCIsImZvdW5kIiwiY2hhbGxlbmdlRnJvbURiIiwiY2hhbGxlbmdlIiwiY2hhbGxlbmdlRnJvbVJlc3BvbnNlIiwiY2xpZW50RGF0YUpTT04iLCJwYXJzZSIsIkJ1ZmZlciIsImZyb20iLCJ0b1N0cmluZyIsInZlcmlmaWNhdGlvbiIsImV4cGVjdGVkQ2hhbGxlbmdlIiwiZXhwZWN0ZWRPcmlnaW4iLCJleHBlY3RlZFJQSUQiLCJyZXF1aXJlVXNlclZlcmlmaWNhdGlvbiIsInZlcmlmaWVkIiwiaGFzUmVnaXN0cmF0aW9uSW5mbyIsInJlZ2lzdHJhdGlvbkluZm8iLCJ2ZXJpZnlFcnJvciIsImVycm9yTmFtZSIsIm5hbWUiLCJlcnJvck1lc3NhZ2UiLCJlcnJvclN0YWNrIiwic3RhY2siLCJzdWJzdHJpbmciLCJkZXRhaWxzIiwiRXJyb3IiLCJjcmVkZW50aWFsSWRCYXNlNjQiLCJjcmVkZW50aWFsSUQiLCJleGlzdGluZ0NyZWRlbnRpYWwiLCJ3ZWJBdXRobkNyZWRlbnRpYWwiLCJmaW5kVW5pcXVlIiwiY3JlZGVudGlhbElkIiwiY3JlZGVudGlhbCIsImNyZWF0ZSIsInB1YmxpY0tleSIsImNyZWRlbnRpYWxQdWJsaWNLZXkiLCJjb3VudGVyIiwidHJhbnNwb3J0cyIsImRlbGV0ZSIsInN1Y2Nlc3MiLCJjcmVkZW50aWFsX2lkIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/verify/complete/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/server/cors.ts":
/*!********************************!*\
  !*** ./src/lib/server/cors.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getCorsHeaders: () => (/* binding */ getCorsHeaders),\n/* harmony export */   handleCorsOptions: () => (/* binding */ handleCorsOptions),\n/* harmony export */   withCors: () => (/* binding */ withCors)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n\n/**\r\n * CORS headers for cross-origin requests from the frontend (Vercel) to backend (Railway/Render)\r\n */ function getCorsHeaders(request) {\n    // Allow the Vercel frontend origin, or * in development\n    const allowedOrigin = process.env.WEBAUTHN_ORIGIN || // Production: set to your Vercel app origin\n    request.headers.get(\"origin\") || // Development: echo the origin\n    \"*\";\n    return {\n        \"Access-Control-Allow-Origin\": allowedOrigin,\n        \"Access-Control-Allow-Methods\": \"GET, POST, OPTIONS\",\n        \"Access-Control-Allow-Headers\": \"Content-Type, Authorization\",\n        \"Access-Control-Max-Age\": \"86400\"\n    };\n}\n/**\r\n * Handle OPTIONS preflight requests for CORS\r\n */ function handleCorsOptions(request) {\n    return new next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse(null, {\n        status: 204,\n        headers: getCorsHeaders(request)\n    });\n}\n/**\r\n * Add CORS headers to an existing response\r\n */ function withCors(response, request) {\n    const corsHeaders = getCorsHeaders(request);\n    Object.entries(corsHeaders).forEach(([key, value])=>{\n        response.headers.set(key, value);\n    });\n    return response;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3NlcnZlci9jb3JzLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBd0Q7QUFFeEQ7O0NBRUMsR0FDTSxTQUFTQyxlQUFlQyxPQUFvQjtJQUNqRCx3REFBd0Q7SUFDeEQsTUFBTUMsZ0JBQ0pDLFFBQVFDLEdBQUcsQ0FBQ0MsZUFBZSxJQUFJLDRDQUE0QztJQUMzRUosUUFBUUssT0FBTyxDQUFDQyxHQUFHLENBQUMsYUFBYSwrQkFBK0I7SUFDaEU7SUFFRixPQUFPO1FBQ0wsK0JBQStCTDtRQUMvQixnQ0FBZ0M7UUFDaEMsZ0NBQWdDO1FBQ2hDLDBCQUEwQjtJQUM1QjtBQUNGO0FBRUE7O0NBRUMsR0FDTSxTQUFTTSxrQkFBa0JQLE9BQW9CO0lBQ3BELE9BQU8sSUFBSUYscURBQVlBLENBQUMsTUFBTTtRQUM1QlUsUUFBUTtRQUNSSCxTQUFTTixlQUFlQztJQUMxQjtBQUNGO0FBRUE7O0NBRUMsR0FDTSxTQUFTUyxTQUFTQyxRQUFzQixFQUFFVixPQUFvQjtJQUNuRSxNQUFNVyxjQUFjWixlQUFlQztJQUNuQ1ksT0FBT0MsT0FBTyxDQUFDRixhQUFhRyxPQUFPLENBQUMsQ0FBQyxDQUFDQyxLQUFLQyxNQUFNO1FBQy9DTixTQUFTTCxPQUFPLENBQUNZLEdBQUcsQ0FBQ0YsS0FBS0M7SUFDNUI7SUFDQSxPQUFPTjtBQUNUIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2R1YXJmLy4vc3JjL2xpYi9zZXJ2ZXIvY29ycy50cz8wZThhIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tIFwibmV4dC9zZXJ2ZXJcIjtcclxuXHJcbi8qKlxyXG4gKiBDT1JTIGhlYWRlcnMgZm9yIGNyb3NzLW9yaWdpbiByZXF1ZXN0cyBmcm9tIHRoZSBmcm9udGVuZCAoVmVyY2VsKSB0byBiYWNrZW5kIChSYWlsd2F5L1JlbmRlcilcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRDb3JzSGVhZGVycyhyZXF1ZXN0OiBOZXh0UmVxdWVzdCk6IEhlYWRlcnNJbml0IHtcclxuICAvLyBBbGxvdyB0aGUgVmVyY2VsIGZyb250ZW5kIG9yaWdpbiwgb3IgKiBpbiBkZXZlbG9wbWVudFxyXG4gIGNvbnN0IGFsbG93ZWRPcmlnaW4gPVxyXG4gICAgcHJvY2Vzcy5lbnYuV0VCQVVUSE5fT1JJR0lOIHx8IC8vIFByb2R1Y3Rpb246IHNldCB0byB5b3VyIFZlcmNlbCBhcHAgb3JpZ2luXHJcbiAgICByZXF1ZXN0LmhlYWRlcnMuZ2V0KFwib3JpZ2luXCIpIHx8IC8vIERldmVsb3BtZW50OiBlY2hvIHRoZSBvcmlnaW5cclxuICAgIFwiKlwiO1xyXG5cclxuICByZXR1cm4ge1xyXG4gICAgXCJBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW5cIjogYWxsb3dlZE9yaWdpbixcclxuICAgIFwiQWNjZXNzLUNvbnRyb2wtQWxsb3ctTWV0aG9kc1wiOiBcIkdFVCwgUE9TVCwgT1BUSU9OU1wiLFxyXG4gICAgXCJBY2Nlc3MtQ29udHJvbC1BbGxvdy1IZWFkZXJzXCI6IFwiQ29udGVudC1UeXBlLCBBdXRob3JpemF0aW9uXCIsXHJcbiAgICBcIkFjY2Vzcy1Db250cm9sLU1heC1BZ2VcIjogXCI4NjQwMFwiLCAvLyBDYWNoZSBwcmVmbGlnaHQgZm9yIDI0IGhvdXJzXHJcbiAgfTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEhhbmRsZSBPUFRJT05TIHByZWZsaWdodCByZXF1ZXN0cyBmb3IgQ09SU1xyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGhhbmRsZUNvcnNPcHRpb25zKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KTogTmV4dFJlc3BvbnNlIHtcclxuICByZXR1cm4gbmV3IE5leHRSZXNwb25zZShudWxsLCB7XHJcbiAgICBzdGF0dXM6IDIwNCxcclxuICAgIGhlYWRlcnM6IGdldENvcnNIZWFkZXJzKHJlcXVlc3QpLFxyXG4gIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogQWRkIENPUlMgaGVhZGVycyB0byBhbiBleGlzdGluZyByZXNwb25zZVxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHdpdGhDb3JzKHJlc3BvbnNlOiBOZXh0UmVzcG9uc2UsIHJlcXVlc3Q6IE5leHRSZXF1ZXN0KTogTmV4dFJlc3BvbnNlIHtcclxuICBjb25zdCBjb3JzSGVhZGVycyA9IGdldENvcnNIZWFkZXJzKHJlcXVlc3QpO1xyXG4gIE9iamVjdC5lbnRyaWVzKGNvcnNIZWFkZXJzKS5mb3JFYWNoKChba2V5LCB2YWx1ZV0pID0+IHtcclxuICAgIHJlc3BvbnNlLmhlYWRlcnMuc2V0KGtleSwgdmFsdWUpO1xyXG4gIH0pO1xyXG4gIHJldHVybiByZXNwb25zZTtcclxufVxyXG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiZ2V0Q29yc0hlYWRlcnMiLCJyZXF1ZXN0IiwiYWxsb3dlZE9yaWdpbiIsInByb2Nlc3MiLCJlbnYiLCJXRUJBVVRITl9PUklHSU4iLCJoZWFkZXJzIiwiZ2V0IiwiaGFuZGxlQ29yc09wdGlvbnMiLCJzdGF0dXMiLCJ3aXRoQ29ycyIsInJlc3BvbnNlIiwiY29yc0hlYWRlcnMiLCJPYmplY3QiLCJlbnRyaWVzIiwiZm9yRWFjaCIsImtleSIsInZhbHVlIiwic2V0Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/server/cors.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/server/prisma.ts":
/*!**********************************!*\
  !*** ./src/lib/server/prisma.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   prisma: () => (/* binding */ prisma)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n\n// Prevent multiple Prisma Client instances in development (hot reload)\nconst globalForPrisma = globalThis;\nconst prisma = globalForPrisma.prisma ?? new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient({\n    log:  true ? [\n        \"query\",\n        \"error\",\n        \"warn\"\n    ] : 0\n});\nif (true) {\n    globalForPrisma.prisma = prisma;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3NlcnZlci9wcmlzbWEudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQThDO0FBRTlDLHVFQUF1RTtBQUN2RSxNQUFNQyxrQkFBa0JDO0FBSWpCLE1BQU1DLFNBQ1hGLGdCQUFnQkUsTUFBTSxJQUN0QixJQUFJSCx3REFBWUEsQ0FBQztJQUNmSSxLQUFLQyxLQUFzQyxHQUFHO1FBQUM7UUFBUztRQUFTO0tBQU8sR0FBRyxDQUFTO0FBQ3RGLEdBQUc7QUFFTCxJQUFJQSxJQUFxQyxFQUFFO0lBQ3pDSixnQkFBZ0JFLE1BQU0sR0FBR0E7QUFDM0IiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zZHVhcmYvLi9zcmMvbGliL3NlcnZlci9wcmlzbWEudHM/YTA1NSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQcmlzbWFDbGllbnQgfSBmcm9tIFwiQHByaXNtYS9jbGllbnRcIjtcclxuXHJcbi8vIFByZXZlbnQgbXVsdGlwbGUgUHJpc21hIENsaWVudCBpbnN0YW5jZXMgaW4gZGV2ZWxvcG1lbnQgKGhvdCByZWxvYWQpXHJcbmNvbnN0IGdsb2JhbEZvclByaXNtYSA9IGdsb2JhbFRoaXMgYXMgdW5rbm93biBhcyB7XHJcbiAgcHJpc21hOiBQcmlzbWFDbGllbnQgfCB1bmRlZmluZWQ7XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgcHJpc21hID1cclxuICBnbG9iYWxGb3JQcmlzbWEucHJpc21hID8/XHJcbiAgbmV3IFByaXNtYUNsaWVudCh7XHJcbiAgICBsb2c6IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSBcImRldmVsb3BtZW50XCIgPyBbXCJxdWVyeVwiLCBcImVycm9yXCIsIFwid2FyblwiXSA6IFtcImVycm9yXCJdLFxyXG4gIH0pO1xyXG5cclxuaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSBcInByb2R1Y3Rpb25cIikge1xyXG4gIGdsb2JhbEZvclByaXNtYS5wcmlzbWEgPSBwcmlzbWE7XHJcbn1cclxuIl0sIm5hbWVzIjpbIlByaXNtYUNsaWVudCIsImdsb2JhbEZvclByaXNtYSIsImdsb2JhbFRoaXMiLCJwcmlzbWEiLCJsb2ciLCJwcm9jZXNzIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/server/prisma.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/tr46","vendor-chunks/@simplewebauthn","vendor-chunks/whatwg-url","vendor-chunks/webidl-conversions","vendor-chunks/@peculiar","vendor-chunks/asn1js","vendor-chunks/cross-fetch","vendor-chunks/@levischuck","vendor-chunks/tslib","vendor-chunks/pvtsutils","vendor-chunks/pvutils","vendor-chunks/@hexagon"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fverify%2Fcomplete%2Froute&page=%2Fapi%2Fverify%2Fcomplete%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fverify%2Fcomplete%2Froute.ts&appDir=C%3A%5CUsers%5Cjiami%5COneDrive%5CDesktop%5Cworkspace%5Ckms_please%5Csduarf%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cjiami%5COneDrive%5CDesktop%5Cworkspace%5Ckms_please%5Csduarf&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();